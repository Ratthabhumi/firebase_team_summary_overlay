<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Rugby Match Admin</title>
Â  <style>
Â  Â  body {
Â  Â  Â  background: #000;
Â  Â  Â  font-family: 'Segoe UI', sans-serif;
Â  Â  Â  color: #fff;
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 20px;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  align-items: center; /* Center the main content horizontally */
Â  Â  }
Â  Â  h1 {
Â  Â  Â  text-align: center;
Â  Â  Â  margin-bottom: 20px;
Â  Â  }
Â  Â  .team-selector {
Â  Â  Â  text-align: center;
Â  Â  Â  margin-bottom: 20px;
Â  Â  }
Â  Â  .team-selector button {
Â  Â  Â  margin: 0 10px;
Â  Â  Â  padding: 10px 20px;
Â  Â  Â  font-size: 16px;
Â  Â  Â  background: #fff;
Â  Â  Â  color: #000;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 5px;
Â  Â  Â  cursor: pointer;
Â  Â  }
Â  Â  .team-selector button.active {
Â  Â  Â  background: #007bff;
Â  Â  Â  color: #000;
Â  Â  }

Â  Â  /* Main grid for organizing sections */
Â  Â  .main-stats-container {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: repeat(2, 1fr); /* Two columns for sections */
Â  Â  Â  gap: 20px; /* Gap between sections */
Â  Â  Â  max-width: 1200px; /* Limit overall width */
Â  Â  Â  width: 100%;
Â  Â  Â  background: #111; /* Background for the entire stats area */
Â  Â  Â  padding: 20px;
Â  Â  Â  border-radius: 10px;
Â  Â  }

Â  Â  /* Styles for each stat section (TERRITORY, ATTACK, etc.) */
Â  Â  .stat-section {
Â  Â  Â  background: #222; /* Slightly darker background for individual sections */
Â  Â  Â  padding: 15px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  gap: 10px; /* Gap between rows within a section */
Â  Â  }

Â  Â  .section-title {
Â  Â  Â  font-size: 1.2em;
Â  Â  Â  font-weight: bold;
Â  Â  Â  text-align: center;
Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  text-transform: uppercase;
Â  Â  Â  color: #eee;
Â  Â  }

Â  Â  /* Specific styles for the stat rows within sections */
Â  Â  .section-stats-grid {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: 1fr 2fr 1fr; /* Team A, Label+Controls, Team B */
Â  Â  Â  gap: 5px; /* Smaller gap within stats rows */
Â  Â  Â  align-items: center;
Â  Â  }

Â  Â  /* Special layout for possession/territory bars */
Â  Â  .bar-stat-row {
Â  Â  Â  grid-column: span 3; /* Span across all 3 columns */
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  gap: 5px;
Â  Â  Â  align-items: center;
Â  Â  Â  padding: 5px 0;
Â  Â  Â  border-bottom: 1px solid #333;
Â  Â  }

Â  Â  .bar-label {
Â  Â  Â  font-weight: bold;
Â  Â  Â  text-align: center;
Â  Â  }

Â  Â  .progress-bar-container {
Â  Â  Â  width: 90%;
Â  Â  Â  height: 20px;
Â  Â  Â  background-color: #555;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  display: flex;
Â  Â  Â  overflow: hidden;
Â  Â  Â  margin-top: 5px;
Â  Â  }

Â  Â  .team-a-bar {
Â  Â  Â  height: 100%;
Â  Â  Â  background-color: #007bff; /* Blue */
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: flex-end;
Â  Â  Â  padding-right: 5px;
Â  Â  Â  color: white;
Â  Â  Â  font-weight: bold;
Â  Â  Â  transition: width 0.3s ease-in-out;
Â  Â  }

Â  Â  .team-b-bar {
Â  Â  Â  height: 100%;
Â  Â  Â  background-color: #dc3545; /* Red */
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: flex-start;
Â  Â  Â  padding-left: 5px;
Â  Â  Â  color: white;
Â  Â  Â  font-weight: bold;
Â  Â  Â  transition: width 0.3s ease-in-out;
Â  Â  }
Â  Â  .bar-values {
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  width: 90%;
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  margin-top: -15px; /* Pull values up over the bar */
Â  Â  Â  Â  z-index: 1; /* Ensure values are above the bar */
Â  Â  }


Â  Â  /* For regular stat rows */
Â  Â  .stat-row {
Â  Â  Â  Â  display: contents; /* Allows children to participate directly in the grid */
Â  Â  }

Â  Â  .stat-label-item {
Â  Â  Â  text-align: center;
Â  Â  Â  font-weight: bold;
Â  Â  Â  padding: 5px 0;
Â  Â  Â  grid-column: 2; /* Middle column for label */
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  border-bottom: 1px solid #444; /* Separator for each stat row */
Â  Â  }

Â  Â  .stat-cell {
Â  Â  Â  text-align: center;
Â  Â  Â  background: #333; /* Darker background for score cells */
Â  Â  Â  padding: 8px;
Â  Â  Â  border-radius: 4px;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  font-size: 1.1em; /* Slightly larger font for numbers */
Â  Â  }
Â  Â  .stat-controls {
Â  Â  Â  display: flex;
Â  Â  Â  gap: 5px;
Â  Â  Â  margin-top: 5px; /* Space between label and buttons */
Â  Â  }
Â  Â  button {
Â  Â  Â  padding: 4px 8px;
Â  Â  Â  font-size: 14px;
Â  Â  Â  border: 1px solid #888;
Â  Â  Â  border-radius: 4px;
Â  Â  Â  background: #000;
Â  Â  Â  color: #fff;
Â  Â  Â  cursor: pointer;
Â  Â  }
Â  Â  button:hover {
Â  Â  Â  background: #222;
Â  Â  }
Â  Â  .save-btn {
Â  Â  Â  display: block;
Â  Â  Â  margin: 30px auto 0;
Â  Â  Â  padding: 10px 20px;
Â  Â  Â  font-size: 16px;
Â  Â  Â  background-color: #fff;
Â  Â  Â  color: #000;
Â  Â  Â  border-radius: 6px;
Â  Â  Â  border: none;
Â  Â  Â  cursor: pointer;
Â  Â  }
Â  Â  .save-btn:hover {
Â  Â  Â  background-color: #eee;
Â  Â  }
Â  </style>
</head>
<body>

<h1>Rugby Match Admin</h1>
<div class="team-selector">
Â  <button id="team-a" class="active" onclick="selectTeam('a')">Team A</button>
Â  <button id="team-b" onclick="selectTeam('b')">Team B</button>
</div>

<div class="main-stats-container" id="statsPanel">
Â  </div>

<button class="save-btn" onclick="saveToFirebase()">ðŸ’¾ Save to Firebase</button>

<script type="module">
Â  import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js';
Â  import { getDatabase, ref, set } from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js';

Â  const firebaseConfig = {
Â  Â  apiKey: "AIzaSyAxU5xfTf8wRTnkmTHP7pR3Aon7IISRvyY",
Â  Â  authDomain: "rugby-c8da2.firebaseapp.com",
Â  Â  databaseURL: "https://rugby-c8da2-default-rtdb.asia-southeast1.firebasedatabase.app",
Â  Â  projectId: "rugby-c8da2",
Â  Â  storageBucket: "rugby-c8da2.appspot.com",
Â  Â  messagingSenderId: "812436187599",
Â  Â  appId: "1:812436187599:web:4dd147d1b35c2122c08aba",
Â  Â  measurementId: "G-07W3W2VZND"
Â  };

Â  const app = initializeApp(firebaseConfig);
Â  const db = getDatabase(app);
Â  const summaryRef = ref(db, 'summary');

Â  // Re-organize stats into sections to match the image
Â  const statSections = [
Â  Â  {
Â  Â  Â  Â  title: "TERRITORY WHOLE GAME",
Â  Â  Â  Â  type: "bar",
Â  Â  Â  Â  stats: [['Territory (%)', 'territory_wg']]
Â  Â  },
Â  Â  {
Â  Â  Â  Â  title: "POSSESSION WHOLE GAME",
Â  Â  Â  Â  type: "bar",
Â  Â  Â  Â  stats: [['Possession (%)', 'possession_wg']]
Â  Â  },
Â  Â  {
Â  Â  Â  Â  title: "POSSESSION FIRST HALF",
Â  Â  Â  Â  type: "bar",
Â  Â  Â  Â  stats: [['Possession FH (%)', 'possession_fh']]
Â  Â  },
Â  Â  {
Â  Â  Â  Â  title: "ATTACK",
Â  Â  Â  Â  type: "regular",
Â  Â  Â  Â  stats: [
Â  Â  Â  Â  Â  Â  ['Metres Carried', 'metres_carried'],
Â  Â  Â  Â  Â  Â  ['Runs', 'runs'],
Â  Â  Â  Â  Â  Â  ['Carries Over Gainline', 'gainline_carries'],
Â  Â  Â  Â  Â  Â  ['Passes', 'passes'],
Â  Â  Â  Â  Â  Â  ['Defenders Beaten', 'defenders_beaten'],
Â  Â  Â  Â  Â  Â  ['Offloads', 'offloads'],
Â  Â  Â  Â  Â  Â  ['Mauls Won', 'mauls_won'],
Â  Â  Â  Â  Â  Â  ['Rucks Won', 'rucks_won']
Â  Â  Â  Â  ]
Â  Â  },
    {
        title: "ERRORS & TURNOVERS", 
        type: "regular",
        stats: [
            ['Handling Errors', 'handling_errors'],
            ['Turnovers Conceded', 'turnovers_conceded']
        ]
    },
Â  Â  {
Â  Â  Â  Â  title: "SET PIECES",
Â  Â  Â  Â  type: "mixed", // For Scrums/Lineouts with success rate
Â  Â  Â  Â  stats: [
Â  Â  Â  Â  Â  Â  ['Scrums Won', 'scrums_won', 'scrums_total'], // [label, won_key, total_key]
Â  Â  Â  Â  Â  Â  ['Lineouts Won', 'lineouts_won', 'lineouts_total'],
Â  Â  Â  Â  Â  Â  ['Lineout Steals', 'lineout_steals']
Â  Â  Â  Â  ]
Â  Â  },
Â  Â  {
Â  Â  Â  Â  title: "DISCIPLINE",
Â  Â  Â  Â  type: "regular",
Â  Â  Â  Â  stats: [
Â  Â  Â  Â  Â  Â  ['Penalties Conceded', 'penalties_conceded'],
Â  Â  Â  Â  Â  Â  ['Red Cards', 'red_cards'],
Â  Â  Â  Â  Â  Â  ['Yellow Cards', 'yellow_cards']
Â  Â  Â  Â  ]
Â  Â  },
Â  Â  {
Â  Â  Â  Â  title: "KICKING",
Â  Â  Â  Â  type: "regular",
Â  Â  Â  Â  stats: [
Â  Â  Â  Â  Â  Â  ['Kicks From Hand', 'kicks_from_hand'],
Â  Â  Â  Â  Â  Â  ['Metres From Kicks', 'metres_from_kicks'],
Â  Â  Â  Â  Â  Â  ['Kicks Regathered', 'kicks_regathered'],
Â  Â  Â  Â  Â  Â  ['Kicks In Touch', 'kicks_in_touch'],
Â  Â  Â  Â  Â  Â  ['Kicks Charged Down', 'kicks_charged_down'],
Â  Â  Â  Â  Â  Â  ['Total Kicks', 'total_kicks']
Â  Â  Â  Â  ]
Â  Â  },
Â  Â  {
Â  Â  Â  Â  title: "DEFENCE",
Â  Â  Â  Â  type: "mixed", // For Tackles with success rate, and others regular
Â  Â  Â  Â  stats: [
Â  Â  Â  Â  Â  Â  ['Tackles', 'tackles'],
Â  Â  Â  Â  Â  Â  ['Tackles Missed', 'tackles_missed'],
Â  Â  Â  Â  Â  Â  ['Tackle Success (%)', 'tackle_success'], // This is a percentage, not absolute numbers
Â  Â  Â  Â  Â  Â  ['Turnovers Won', 'turnovers_won']
Â  Â  Â  Â  ]
Â  Â  }
Â  ];

Â  // Flattened list of all stat keys for Firebase saving
Â  const allStatKeys = [];
Â  statSections.forEach(section => {
Â  Â  section.stats.forEach(stat => {
Â  Â  Â  if (section.type === "mixed" && stat.length > 2) {
Â  Â  Â  Â  allStatKeys.push(stat[1]); // won_key
Â  Â  Â  Â  allStatKeys.push(stat[2]); // total_key
Â  Â  Â  } else {
Â  Â  Â  Â  allStatKeys.push(stat[1]); // regular key
Â  Â  Â  }
Â  Â  });
Â  });

Â  let selectedTeam = 'a'; // Default to Team A

Â  window.selectTeam = function(team) {
Â  Â  selectedTeam = team;
Â  Â  document.getElementById('team-a').classList.remove('active');
Â  Â  document.getElementById('team-b').classList.remove('active');
Â  Â  document.getElementById('team-' + team).classList.add('active');
Â  }

Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  const mainContainer = document.getElementById('statsPanel');

Â  Â  statSections.forEach(section => {
Â  Â  Â  const sectionDiv = document.createElement('div');
Â  Â  Â  sectionDiv.classList.add('stat-section');

Â  Â  Â  const titleDiv = document.createElement('div');
Â  Â  Â  titleDiv.classList.add('section-title');
Â  Â  Â  titleDiv.textContent = section.title;
Â  Â  Â  sectionDiv.appendChild(titleDiv);

Â  Â  Â  const sectionStatsGrid = document.createElement('div');
Â  Â  Â  sectionStatsGrid.classList.add('section-stats-grid');

Â  Â  Â  if (section.type === 'bar') {
Â  Â  Â  Â  // Handle bar stats (Territory, Possession)
Â  Â  Â  Â  section.stats.forEach(([label, key]) => {
Â  Â  Â  Â  Â  const barStatRow = document.createElement('div');
Â  Â  Â  Â  Â  barStatRow.classList.add('bar-stat-row');
Â  Â  Â  Â  Â  barStatRow.innerHTML = `
Â  Â  Â  Â  Â  Â  <div class="bar-label">${label}</div>
Â  Â  Â  Â  Â  Â  <div class="bar-values">
Â  Â  Â  Â  Â  Â  Â  Â  <span id="a-${key}-value">0%</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="b-${key}-value">0%</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="progress-bar-container">
Â  Â  Â  Â  Â  Â  Â  <div class="team-a-bar" id="a-${key}-bar" style="width: 50%;"></div>
Â  Â  Â  Â  Â  Â  Â  <div class="team-b-bar" id="b-${key}-bar" style="width: 50%;"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="stat-controls">
Â  Â  Â  Â  Â  Â  Â  <button onclick="adjustBar('${key}', 5)">+</button>
Â  Â  Â  Â  Â  Â  Â  <button onclick="adjustBar('${key}', -5)">-</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  sectionStatsGrid.appendChild(barStatRow);
Â  Â  Â  Â  });
Â  Â  Â  } else if (section.type === 'mixed') {
Â  Â  Â  Â  section.stats.forEach(stat => {
Â  Â  Â  Â  Â  Â  const label = stat[0];
Â  Â  Â  Â  Â  Â  const key = stat[1]; // primary key like 'scrums_won'
Â  Â  Â  Â  Â  Â  const totalKey = stat[2]; // secondary key like 'scrums_total'

Â  Â  Â  Â  Â  Â  if (totalKey) { // This is a "won/total" stat (Scrums, Lineouts)
Â  Â  Â  Â  Â  Â  Â  Â  sectionStatsGrid.insertAdjacentHTML('beforeend', `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-cell" id="a-${key}">0/<span id="a-${totalKey}">0</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-label-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${label}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-controls">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="adjust('${key}',1, '${totalKey}')">+</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="adjust('${key}',-1, '${totalKey}')">-</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="adjustTotal('${totalKey}',1)">T+</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="adjustTotal('${totalKey}',-1)">T-</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-cell" id="b-${key}">0/<span id="b-${totalKey}">0</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  `);
Â  Â  Â  Â  Â  Â  } else if (key === 'tackle_success') { // Special case for Tackle Success %
Â  Â  Â  Â  Â  Â  Â  Â  Â sectionStatsGrid.insertAdjacentHTML('beforeend', `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-cell" id="a-${key}">0%</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-label-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${label}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-controls">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="adjust('${key}',5)">+</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="adjust('${key}',-5)">-</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-cell" id="b-${key}">0%</div>
Â  Â  Â  Â  Â  Â  Â  Â  `);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else { // Regular stat within mixed section (e.g. Lineout Steals, Tackles, Tackles Missed, Turnovers Won)
Â  Â  Â  Â  Â  Â  Â  Â  sectionStatsGrid.insertAdjacentHTML('beforeend', `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-cell" id="a-${key}">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-label-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${label}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-controls">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="adjust('${key}',1)">+</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="adjust('${key}',-1)">-</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-cell" id="b-${key}">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  `);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  Â  else { // Regular stats (Attack, Discipline, Kicking)
Â  Â  Â  Â  section.stats.forEach(([label, key]) => {
Â  Â  Â  Â  Â  sectionStatsGrid.insertAdjacentHTML('beforeend', `
Â  Â  Â  Â  Â  Â  <div class="stat-cell" id="a-${key}">0</div>
Â  Â  Â  Â  Â  Â  <div class="stat-label-item">
Â  Â  Â  Â  Â  Â  Â  ${label}
Â  Â  Â  Â  Â  Â  Â  <div class="stat-controls">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="adjust('${key}',1)">+</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="adjust('${key}',-1)">-</button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="stat-cell" id="b-${key}">0</div>
Â  Â  Â  Â  Â  `);
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  Â  sectionDiv.appendChild(sectionStatsGrid);
Â  Â  Â  mainContainer.appendChild(sectionDiv);
Â  Â  });
Â  });

Â  // Adjust function for regular stats
Â  window.adjust = function(statKey, diff, totalKey = null) {
Â  Â  const targetElementId = `${selectedTeam}-${statKey}`;
Â  Â  const targetElement = document.getElementById(targetElementId);
Â  Â  if (!targetElement) {
Â  Â  Â  Â  console.warn(`Element with ID ${targetElementId} not found.`);
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  let current;
Â  Â  if (totalKey) { // For "won/total" stats
Â  Â  Â  Â  const currentWon = parseFloat(targetElement.textContent.split('/')[0]);
Â  Â  Â  Â  const currentTotal = parseFloat(document.getElementById(`${selectedTeam}-${totalKey}`).textContent);
Â  Â  Â  Â  if (statKey.includes('_won')) { // Adjusting 'won' part
Â  Â  Â  Â  Â  Â  current = currentWon + diff;
Â  Â  Â  Â  Â  Â  if (current < 0) current = 0;
Â  Â  Â  Â  Â  Â  if (current > currentTotal) current = currentTotal; // Can't win more than total
Â  Â  Â  Â  Â  Â  targetElement.textContent = `${current}/${currentTotal}`;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // This branch is now handled by adjustTotal
Â  Â  Â  Â  }
Â  Â  } else { // For regular number stats or percentages
Â  Â  Â  Â  current = parseFloat(targetElement.textContent.replace('%', ''));
Â  Â  Â  Â  current += diff;
Â  Â  Â  Â  if (current < 0) current = 0;
Â  Â  Â  Â  if (statKey.includes('possession') || statKey.includes('tackle_success')) {
Â  Â  Â  Â  Â  Â  if (current > 100) current = 100;
Â  Â  Â  Â  Â  Â  targetElement.textContent = `${current}%`;
Â  Â  Â  Â  } else if (statKey.includes('territory')) {
Â  Â  Â  Â  Â  Â  current = parseFloat(current.toFixed(1)); // Keep one decimal for territory
Â  Â  Â  Â  Â  Â  targetElement.textContent = `${current}%`;
Â  Â  Â  Â  }
Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  targetElement.textContent = current;
Â  Â  Â  Â  }
Â  Â  }
Â  }

Â  // New function specifically for adjusting total (e.g. scrums_total)
Â  window.adjustTotal = function(totalKey, diff) {
Â  Â  Â  const targetTotalElementId = `${selectedTeam}-${totalKey}`;
Â  Â  Â  const targetTotalElement = document.getElementById(targetTotalElementId);
Â  Â  Â  if (!targetTotalElement) {
Â  Â  Â  Â  Â  console.warn(`Element with ID ${targetTotalElementId} not found.`);
Â  Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  let currentTotal = parseFloat(targetTotalElement.textContent);
Â  Â  Â  currentTotal += diff;
Â  Â  Â  if (currentTotal < 0) currentTotal = 0;

Â  Â  Â  // Update the total part of the display (e.g. 5/10)
Â  Â  Â  const wonKey = totalKey.replace('_total', '_won');
Â  Â  Â  const wonElement = document.getElementById(`${selectedTeam}-${wonKey}`);
Â  Â  Â  if (wonElement) {
Â  Â  Â  Â  Â  const currentWon = parseFloat(wonElement.textContent.split('/')[0]);
Â  Â  Â  Â  Â  if (currentWon > currentTotal) { // If won is now greater than new total
Â  Â  Â  Â  Â  Â  Â  wonElement.textContent = `${currentTotal}/${currentTotal}`;
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  wonElement.textContent = `${currentWon}/${currentTotal}`;
Â  Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  Â  // Fallback if won element not found, just update the total span
Â  Â  Â  Â  Â  targetTotalElement.textContent = currentTotal;
Â  Â  Â  }
Â  Â  Â  targetTotalElement.textContent = currentTotal; // This updates the span within the won/total display
Â  }

Â  // Adjust function for bar stats (Territory, Possession)
Â  window.adjustBar = function(statKey, diff) {
Â  Â  Â  let currentA = parseFloat(document.getElementById(`a-${statKey}-value`).textContent.replace('%', ''));
Â  Â  Â  let currentB = parseFloat(document.getElementById(`b-${statKey}-value`).textContent.replace('%', ''));

Â  Â  Â  if (selectedTeam === 'a') {
Â  Â  Â  Â  Â  currentA += diff;
Â  Â  Â  Â  Â  if (currentA < 0) currentA = 0;
Â  Â  Â  Â  Â  if (currentA > 100) currentA = 100;
Â  Â  Â  Â  Â  currentB = 100 - currentA;
Â  Â  Â  } else { // selectedTeam === 'b'
Â  Â  Â  Â  Â  currentB += diff;
Â  Â  Â  Â  Â  if (currentB < 0) currentB = 0;
Â  Â  Â  Â  Â  if (currentB > 100) currentB = 100;
Â  Â  Â  Â  Â  currentA = 100 - currentB;
Â  Â  Â  }

Â  Â  Â  document.getElementById(`a-${statKey}-value`).textContent = `${currentA}%`;
Â  Â  Â  document.getElementById(`b-${statKey}-value`).textContent = `${currentB}%`;
Â  Â  Â  document.getElementById(`a-${statKey}-bar`).style.width = `${currentA}%`;
Â  Â  Â  document.getElementById(`b-${statKey}-bar`).style.width = `${currentB}%`;
Â  }


Â  window.saveToFirebase = function() {
Â  Â  const data = { a: {}, b: {} };
Â  Â  // Iterate through the structured sections to save correct data
Â  Â  statSections.forEach(section => {
Â  Â  Â  Â  section.stats.forEach(stat => {
Â  Â  Â  Â  Â  Â  const key = stat[1]; // Primary key
Â  Â  Â  Â  Â  Â  const totalKey = stat[2]; // Secondary key for 'won/total' stats

Â  Â  Â  Â  Â  Â  if (section.type === 'bar') {
Â  Â  Â  Â  Â  Â  Â  Â  // For bar stats, get the current percentage from the UI
Â  Â  Â  Â  Â  Â  Â  Â  const valA = parseFloat(document.getElementById(`a-${key}-value`).textContent.replace('%', ''));
Â  Â  Â  Â  Â  Â  Â  Â  const valB = parseFloat(document.getElementById(`b-${key}-value`).textContent.replace('%', ''));
Â  Â  Â  Â  Â  Â  Â  Â  data['a'][key] = valA;
Â  Â  Â  Â  Â  Â  Â  Â  data['b'][key] = valB;
Â  Â  Â  Â  Â  Â  } else if (totalKey) { // Won/Total stats
Â  Â  Â  Â  Â  Â  Â  Â  const valAWon = parseFloat(document.getElementById(`a-${key}`).textContent.split('/')[0]);
Â  Â  Â  Â  Â  Â  Â  Â  const valATotal = parseFloat(document.getElementById(`a-${totalKey}`).textContent);
Â  Â  Â  Â  Â  Â  Â  Â  const valBWon = parseFloat(document.getElementById(`b-${key}`).textContent.split('/')[0]);
Â  Â  Â  Â  Â  Â  Â  Â  const valBTotal = parseFloat(document.getElementById(`b-${totalKey}`).textContent);

Â  Â  Â  Â  Â  Â  Â  Â  data['a'][key] = valAWon; // e.g., scrums_won
Â  Â  Â  Â  Â  Â  Â  Â  data['a'][totalKey] = valATotal; // e.g., scrums_total
Â  Â  Â  Â  Â  Â  Â  Â  data['b'][key] = valBWon;
Â  Â  Â  Â  Â  Â  Â  Â  data['b'][totalKey] = valBTotal;

Â  Â  Â  Â  Â  Â  } else { // Regular stats and percentages like tackle success
Â  Â  Â  Â  Â  Â  Â  Â  const valA = parseFloat(document.getElementById(`a-${key}`).textContent.replace('%', ''));
Â  Â  Â  Â  Â  Â  Â  Â  const valB = parseFloat(document.getElementById(`b-${key}`).textContent.replace('%', ''));
Â  Â  Â  Â  Â  Â  Â  Â  data['a'][key] = valA;
Â  Â  Â  Â  Â  Â  Â  Â  data['b'][key] = valB;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  });

Â  Â  set(summaryRef, data).then(() => alert('âœ… Data saved!'))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .catch(error => console.error("Error saving to Firebase:", error));
Â  }
</script>
</body>
</html>